%%
%% This is a DocBook LaTeX style example
%%
\def\flakaversion{1.02}

%%%\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{flaka}[2010/02/10 haefelinger IT flaka]

% The defined options
\DeclareOption{hyperlink}{ \def\DBKhyperlink{yes} }
\DeclareOption{nohyperlink}{ \def\DBKhyperlink{no} }

% Default values
\ExecuteOptions{hyperlink}

% If defined, process the options
\ProcessOptions\relax

% Needed packages
%
% Need to define this cause some dblatex sty files depend on it (???)
%
\IfFileExists{ifxetex.sty}{%
  \usepackage{ifxetex}  %
  \usepackage{xltxtra}  % provides also \XeTeX
  \usepackage{fontspec}
  \setmonofont{Andale Mono} 
  \usepackage{cmbright}
}{%
  \newif\ifxetex
  \xetexfalse
}
\usepackage[sf,sl,outermarks]{titlesec}
% wanna have A4 paper in any case.
\usepackage[a4paper,textwidth=13cm,top=2cm,bottom=3cm]{geometry}
\addtolength{\hoffset}{-1cm}

%
% Still required when using XeTeX (??)
%
\usepackage[T1]{fontenc}
% TODO: make sure that we are processing an UTF-8 document.

\usepackage[subfigure]{tocloft}
\usepackage[usenames]{xcolor}
% 
% lastpage:
% provides me with a nice (?) counter for the total number of pages
%
\usepackage{lastpage}
\usepackage{fancyhdr}
\usepackage{everypage}
\usepackage{afterpage}

% dbk packages
\usepackage{float}

%
% Make sure that dbk_core is using default values of package listings 
%

\newcommand{\lstparamset}{}
\usepackage{dbk_core}


\usepackage{ellipsis,ragged2e,marginnote}


\title{}
\author{}

\hypersetup{
      bookmarks=true,
      pdftitle={The Flaka \flakaversion Manual},
      pdfauthor={Wolfgang Häfelinger},
      pdfsubject={The Flaka Documentation},
      pdfcreator={XeTeX},        
      pdfproducer={haefelinger IT},
      pdfkeywords={flaka,ant,häfelinger IT,english,Wolfgang Häfelinger},
      urlcolor=red,
      linkcolor=blue
}

\setlength{\parindent}{0cm}

\xdefinecolor{red}{rgb}{1.0,0.0,0.0}
\xdefinecolor{greenyellow}{rgb}{0.85,1,0.31}
\xdefinecolor{ForestGreen}{rgb}{0,0.44,0}

\newcommand{\fgcolordefault}{black}
\newcommand{\bgcolordefault}{white}

%
% gap between lines
%
\renewcommand{\baselinestretch}{1.1}

\newcommand{\coverpage}{
  \thispagestyle{empty}
  \pagecolor{red}
  \color{white}
  \begin{flushright}
    \Huge The Flaka Manual\\[1em]
    \large
    Wolfgang H\"afelinger\\
    h\"afelinger IT\\[1cm]
    Flaka, version \textbf{\flakaversion}\\[2cm]
    \today\\ draft document version 1.0\\[1cm]
 \end{flushright}
}

%
% Redefining \section and \subsection
%
% Note: when using  character '@' within a definition I would need to embrace
% it by \makeatletter .. \maketoletter. However, this needs only be done when
% within a document. Here I am within a package and therefore I can ommit it.

%\makeatletter 

% \renewcommand\section{\pagebreak%
% \@startsection {section}{1}{\z@}% 
%   {-2.5ex \@plus -1ex \@minus -.2ex}% 
%   {1.3ex \@plus.2ex}% 
%   {\color{red}\normalfont\Huge}} 

% \renewcommand\subsection{%
% \@startsection {subsection}{1}{\z@}% 
%   {-2.5ex \@plus -1ex \@minus -.2ex}% 
%   {1.3ex \@plus.2ex}% 
%   {\color{red}\normalfont\Huge}} 

%
% Redefine \subsubsection command.
%

% \renewcommand\subsubsection{%
%     \@startsection{subsubsection}{2}{\z@}{1pt}{1pt} {%
%          \Large\color{red}
%     }%
% }%

% \renewcommand{\cftaftertoctitle}{
%   \thispagestyle{empty}
% } 

% \renewcommand{\cfttoctitlefont}{\color{red}\large} 
%\renewcommand{\cftsecfont}{\color{red}\normalfont\scshape} 

%\allsectionsfont{\normalsize\normalfont}
%\allsectionsfont{\sffamily\underline} % Unterstrich

% \titleformat{\section}[frame]{\normalfont}{\filright\footnotesize\enspace SECTION \thesection\enspace} {8pt} {\color{red}\Large\bfseries\filcenter}
% \titleformat{\subsection}[frame]{\normalfont}{\filright\footnotesize\enspace
%   SECTION \thesection\enspace} {8pt}
% {\color{red}\Large\bfseries\filcenter}

%
% Define how pages look like
%
%\pagestyle{fancy}
%\fancyhf{}

% cancel the line in the head
\renewcommand{\headrulewidth}{0pt} 
\renewcommand{\footrulewidth}{0pt} 

%
% What I want to achive is a kind of logo showing up in a kind of sidebar, something like
% shown below:
%
%       +-----------------+-----------+
%       |                 |           |
%       |  Here we        |           |
%       |  have just a    |           |
%       |  normal text.   | +------+  |
%       |                 | | My   |  |
%       |                 | | Logo |  |
%       |                 | | here!|  |
%       |                 | +------+  |
%       |                 |           |
%       |                 |           |
%       |                 |           |
%       +-----------------+-----------+
%
% My initial idea was to create a margin on the right side and issue with each \section
% a margin note with that logo. In addition, each section would start a new page. This 
% works fine as long as there is no section spawning multiple pages.
% A better idea is to put the logo in the header, cause the header is generated for each
% and every page. The problem is of course how to "float" the logo out of the header to
% reach the desired effect?
% It's very cumbersome but this is how to do it in LaTeX:
% 1. create a picture with height and width both set to 0.
% 2. within the picture, use a \put statement to put your logo wherever you like.
% This is how it's implemented below.

\rhead{ 
  \begin{picture}(0,0) 
    \put(60,0){\parbox[t][2cm]{5cm}{
        \color{red}
        \vspace{1cm}
        Flaka \flakaversion\\
        h\"afelinger IT\\[1em]
        \thepage/\pageref{LastPage}
        \color{\fgcolordefault}
      }
    } 
  \end{picture}
}


%
% This command lets me insert commands to be executed at the begin of the
% the document.
%

\AtBeginDocument{
  \coverpage
  \clearpage
  \pagecolor{\bgcolordefault}
  \color{\fgcolordefault}
}

\AtEndDocument{
  \section{Colophon}
This document got written in Asciidoc markup and translated into DocBook by using the \texttt{asciidoc} command. From DocBook it got translated into \LaTeX\ using \texttt{dblatex} and from \LaTeX\ eventually into PDF by using \XeTeX.

}




%
% gap between paragraphs 
%

\setlength{\parskip}{11pt plus 2pt minus 2pt} 

%
% How to render source code ..
%

\lstset{ %
  language=XML,
  xleftmargin=20pt,
  aboveskip=1em,
  belowskip=0pt,
  frame=leftline,
  framexleftmargin=6pt,
  rulecolor=\color{red},
  basicstyle=\footnotesize,
  numbers=none,
  numberstyle=\footnotesize,
  stepnumber=2,
  numbersep=5pt,
  backgroundcolor=\color{white},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2,
  captionpos=b,
  breaklines=true,
  breakatwhitespace=false,
  escapeinside={\%*}{*)}
}
